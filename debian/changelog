postgresql-9.2 (9.2.12-1.pgdg+1) unstable; urgency=medium

  * New upstream version:
    Avoid failures while fsync'ing data directory during crash restart
    (Abhijit Menon-Sen, Tom Lane; Closes: #786874)

 -- Christoph Berg <christoph.berg@credativ.de>  Wed, 03 Jun 2015 12:18:44 +0200

postgresql-9.2 (9.2.11-1.pgdg+1) unstable; urgency=medium

  * New upstream version.

    + Avoid possible crash when client disconnects just before the
      authentication timeout expires (Benkocs Norbert Attila)

      If the timeout interrupt fired partway through the session shutdown
      sequence, SSL-related state would be freed twice, typically causing a
      crash and hence denial of service to other sessions.  Experimentation
      shows that an unauthenticated remote attacker could trigger the bug
      somewhat consistently, hence treat as security issue. (CVE-2015-3165)

    + Improve detection of system-call failures (Noah Misch)

      Our replacement implementation of snprintf() failed to check for errors
      reported by the underlying system library calls; the main case that
      might be missed is out-of-memory situations. In the worst case this
      might lead to information exposure, due to our code assuming that a
      buffer had been overwritten when it hadn't been. Also, there were a few
      places in which security-relevant calls of other system library
      functions did not check for failure.

      It remains possible that some calls of the *printf() family of functions
      are vulnerable to information disclosure if an out-of-memory error
      occurs at just the wrong time.  We judge the risk to not be large, but
      will continue analysis in this area. (CVE-2015-3166)

    + In contrib/pgcrypto, uniformly report decryption failures as Wrong key
      or corrupt data (Noah Misch)

      Previously, some cases of decryption with an incorrect key could report
      other error message texts.  It has been shown that such variance in
      error reports can aid attackers in recovering keys from other systems.
      While it's unknown whether pgcrypto's specific behaviors are likewise
      exploitable, it seems better to avoid the risk by using a
      one-size-fits-all message. (CVE-2015-3167)

  * Repository moved to git, update Vcs headers.

 -- Christoph Berg <christoph.berg@credativ.de>  Wed, 20 May 2015 13:32:46 +0200

postgresql-9.2 (9.2.10-1.pgdg+1) sid-pgdg; urgency=medium

  * New upstream release.
    + Fix buffer overruns in to_char() (CVE-2015-0241)
    + Fix buffer overruns in contrib/pgcrypto (CVE-2015-0243)
    + Fix possible loss of frontend/backend protocol synchronization after an
      error (CVE-2015-0244)
    + Fix information leak via constraint-violation error messages
      (CVE-2014-8161)
  * debian/patches/63-pg_upgrade-test-bindir: Unfuzz.

 -- Christoph Berg <myon@debian.org>  Wed, 04 Feb 2015 23:12:47 +0100

postgresql-9.2 (9.2.9-1.pgdg+1) sid-pgdg; urgency=medium

  * New upstream release.
    + Secure Unix-domain sockets of temporary postmasters started during make
      check (Noah Misch)

      Any local user able to access the socket file could connect as the
      server's bootstrap superuser, then proceed to execute arbitrary code as
      the operating-system user running the test, as we previously noted in
      CVE-2014-0067. This change defends against that risk by placing the
      server's socket in a temporary, mode 0700 subdirectory of /tmp.

  * Remove our pg_regress patches to support --host=/path.
  * Add 63-pg_upgrade-test-bindir (which we just removed from 9.3 and 9.4).
  * Remove the tcl8.6 patch, went upstream.
  * Skip -pie on 32bit archs for performance and stability reasons.
    Closes: #749686; details at
    http://www.postgresql.org/message-id/20140519115318.GB7296@msgid.df7cb.de

 -- Christoph Berg <myon@debian.org>  Tue, 22 Jul 2014 00:22:34 +0200

postgresql-9.2 (9.2.8-1.pgdg+1) sid-pgdg; urgency=medium

  * New upstream bugfix release.
  * Build with tcl8.6 where available (>= Jessie, >= trusty).
  * Compile with -fno-omit-frame-pointer on amd64 to facilitate hierarchical
    profile generation. (Closes: #730134)
  * Remove obsolete configure option --with-tkconfig.

 -- Christoph Berg <myon@debian.org>  Tue, 18 Mar 2014 07:33:00 +0100

postgresql-9.2 (9.2.7-1.pgdg+1) sid-pgdg; urgency=medium

  * New upstream security/bugfix release.

    + Shore up GRANT ... WITH ADMIN OPTION restrictions (Noah Misch)

      Granting a role without ADMIN OPTION is supposed to prevent the grantee
      from adding or removing members from the granted role, but this
      restriction was easily bypassed by doing SET ROLE first. The security
      impact is mostly that a role member can revoke the access of others,
      contrary to the wishes of his grantor. Unapproved role member additions
      are a lesser concern, since an uncooperative role member could provide
      most of his rights to others anyway by creating views or SECURITY
      DEFINER functions. (CVE-2014-0060)

    + Prevent privilege escalation via manual calls to PL validator functions
      (Andres Freund)

      The primary role of PL validator functions is to be called implicitly
      during CREATE FUNCTION, but they are also normal SQL functions that a
      user can call explicitly. Calling a validator on a function actually
      written in some other language was not checked for and could be
      exploited for privilege-escalation purposes. The fix involves adding a
      call to a privilege-checking function in each validator function.
      Non-core procedural languages will also need to make this change to
      their own validator functions, if any. (CVE-2014-0061)

    + Avoid multiple name lookups during table and index DDL (Robert Haas,
      Andres Freund)

      If the name lookups come to different conclusions due to concurrent
      activity, we might perform some parts of the DDL on a different table
      than other parts. At least in the case of CREATE INDEX, this can be used
      to cause the permissions checks to be performed against a different
      table than the index creation, allowing for a privilege escalation
      attack. (CVE-2014-0062)

    + Prevent buffer overrun with long datetime strings (Noah Misch)

      The MAXDATELEN constant was too small for the longest possible value of
      type interval, allowing a buffer overrun in interval_out(). Although the
      datetime input functions were more careful about avoiding buffer
      overrun, the limit was short enough to cause them to reject some valid
      inputs, such as input containing a very long timezone name. The ecpg
      library contained these vulnerabilities along with some of its own.
      (CVE-2014-0063)

    + Prevent buffer overrun due to integer overflow in size calculations
      (Noah Misch, Heikki Linnakangas)

      Several functions, mostly type input functions, calculated an allocation
      size without checking for overflow. If overflow did occur, a too-small
      buffer would be allocated and then written past. (CVE-2014-0064)

    + Prevent overruns of fixed-size buffers (Peter Eisentraut, Jozef Mlich)

      Use strlcpy() and related functions to provide a clear guarantee that
      fixed-size buffers are not overrun. Unlike the preceding items, it is
      unclear whether these cases really represent live issues, since in most
      cases there appear to be previous constraints on the size of the input
      string. Nonetheless it seems prudent to silence all Coverity warnings of
      this type. (CVE-2014-0065)

    + Avoid crashing if crypt() returns NULL (Honza Horak, Bruce Momjian)

      There are relatively few scenarios in which crypt() could return NULL,
      but contrib/chkpass would crash if it did. One practical case in which
      this could be an issue is if libc is configured to refuse to execute
      unapproved hashing algorithms (e.g., "FIPS mode"). (CVE-2014-0066)

    + Document risks of make check in the regression testing instructions
      (Noah Misch, Tom Lane)

      Since the temporary server started by make check uses "trust"
      authentication, another user on the same machine could connect to it as
      database superuser, and then potentially exploit the privileges of the
      operating-system user who started the tests. A future release will
      probably incorporate changes in the testing procedure to prevent this
      risk, but some public discussion is needed first. So for the moment,
      just warn people against using make check when there are untrusted users
      on the same machine. (CVE-2014-0067)

  * The upstream tarballs no longer contain a plain HISTORY file, but point to
    the html documentation. Note the location of these files in our
    changelog.gz file.

 -- Christoph Berg <christoph.berg@credativ.de>  Wed, 19 Feb 2014 11:42:55 +0100

postgresql-9.2 (9.2.6-1.pgdg+1) sid-pgdg; urgency=low

  * New upstream version.

    + Fix "VACUUM"'s tests to see whether it can update relfrozenxid
      (Andres Freund)

      In some cases "VACUUM" (either manual or autovacuum) could
      incorrectly advance a table's relfrozenxid value, allowing tuples
      to escape freezing, causing those rows to become invisible once
      2^31 transactions have elapsed. The probability of data loss is
      fairly low since multiple incorrect advancements would need to
      happen before actual loss occurs, but it's not zero. In 9.2.0 and
      later, the probability of loss is higher, and it's also possible to
      get "could not access status of transaction" errors as a
      consequence of this bug. Users upgrading from releases 9.0.4 or
      8.4.8 or earlier are not affected, but all later versions contain
      the bug.
      The issue can be ameliorated by, after upgrading, vacuuming all
      tables in all databases while having vacuum_freeze_table_age set to
      zero. This will fix any latent corruption but will not be able to
      fix all pre-existing data errors. However, an installation can be
      presumed safe after performing this vacuuming if it has executed
      fewer than 2^31 update transactions in its lifetime (check this
      with SELECT txid_current() < 2^31).

    + Fix initialization of "pg_clog" and "pg_subtrans" during hot
      standby startup (Andres Freund, Heikki Linnakangas)

      This bug can cause data loss on standby servers at the moment they
      start to accept hot-standby queries, by marking committed
      transactions as uncommitted. The likelihood of such corruption is
      small unless, at the time of standby startup, the primary server
      has executed many updating transactions since its last checkpoint.
      Symptoms include missing rows, rows that should have been deleted
      being still visible, and obsolete versions of updated rows being
      still visible alongside their newer versions.
      This bug was introduced in versions 9.3.0, 9.2.5, 9.1.10, and
      9.0.14. Standby servers that have only been running earlier
      releases are not at risk. It's recommended that standby servers
      that have ever run any of the buggy releases be re-cloned from the
      primary (e.g., with a new base backup) after upgrading.

  * Refresh debian/patches/62-pg_upgrade-test-in-tmp.

 -- Christoph Berg <myon@debian.org>  Tue, 03 Dec 2013 09:10:47 +0100

postgresql-9.2 (9.2.5-1) sid-pgdg; urgency=low

  * New upstream version.
  * Remove 00git-perl5.18.patch.

 -- Christoph Berg <myon@debian.org>  Tue, 08 Oct 2013 23:13:26 +0200

postgresql-9.2 (9.2.4-2) sid-pgdg; urgency=low

  [ Martin Pitt ]
  * debian/tests/control: Add missing net-tools test dependency.
  * debian/rules: Support multi-arch locations of {tcl,tk}-config.
  * debian/rules: Call dh with --parallel.

  [ Christoph Berg ]
  * debian/rules: Use "make check-world" to run the regression tests. Thanks
    to Peter Eisentraut for the suggestion. Also, use a random port number.
  * 61-extra_regress_opts: Add EXTRA_REGRESS_OPTS in Makefile.global(.in).
  * 62-pg_upgrade-test-in-tmp: Hardcode /tmp in pg_upgrade's test.sh.
  * 64-pg_upgrade-sockdir: If cwd is too long to use as socketdir in
    pg_upgrade, fall back to /tmp. (A Unix socket path must not be longer than
    107 chars.)
  * Pull 6697aa2bc25c83b88d6165340348a31328c35de6 and
    82b0102650cf85268145a46f0ab488bacf6599a1 from upstream head to better
    support VPATH builds of PGXS modules, and make the install targets depend
    on installdirs.
  * Add 00git-perl5.18.patch: Adjust PL/Perl test cases to also work for Perl
    5.18.

 -- Christoph Berg <myon@debian.org>  Thu, 05 Sep 2013 22:03:53 +0200

postgresql-9.2 (9.2.4-1) experimental; urgency=low

  * New upstream security/bug fix release:
    - Fix insecure parsing of server command-line switches.
      A connection request containing a database name that begins with
      "-" could be crafted to damage or destroy files within the server's
      data directory, even if the request is eventually rejected.
      [CVE-2013-1899]
    - Reset OpenSSL randomness state in each postmaster child process.
      This avoids a scenario wherein random numbers generated by
      "contrib/pgcrypto" functions might be relatively easy for another
      database user to guess. The risk is only significant when the
      postmaster is configured with ssl = on but most connections don't
      use SSL encryption. [CVE-2013-1900]
    - Make REPLICATION privilege checks test current user not
      authenticated user.
      An unprivileged database user could exploit this mistake to call
      pg_start_backup() or pg_stop_backup(), thus possibly interfering
      with creation of routine backups. [CVE-2013-1901]
    - Fix GiST indexes to not use "fuzzy" geometric comparisons when it's
      not appropriate to do so.
      The core geometric types perform comparisons using "fuzzy"
      equality, but gist_box_same must do exact comparisons, else GiST
      indexes using it might become inconsistent. After installing this
      update, users should "REINDEX" any GiST indexes on box, polygon,
      circle, or point columns, since all of these use gist_box_same.
    - Fix erroneous range-union and penalty logic in GiST indexes that
      use "contrib/btree_gist" for variable-width data types, that is
      text, bytea, bit, and numeric columns.
      These errors could result in inconsistent indexes in which some
      keys that are present would not be found by searches, and also in
      useless index bloat. Users are advised to "REINDEX" such indexes
      after installing this update.
    - Fix bugs in GiST page splitting code for multi-column indexes.
      These errors could result in inconsistent indexes in which some
      keys that are present would not be found by searches, and also in
      indexes that are unnecessarily inefficient to search. Users are
      advised to "REINDEX" multi-column GiST indexes after installing
      this update.
    - See HISTORY/changelog.gz for details about other bug fixes.
  * Bump Standards-Version to 3.9.4 (no changes necessary).

 -- Martin Pitt <mpitt@debian.org>  Tue, 02 Apr 2013 10:13:55 +0200

postgresql-9.2 (9.2.3-1) experimental; urgency=medium

  [ Martin Pitt ]
  * Add missing docbook build dependency. (Closes: #697618)

  [ Christoph Berg ]
  * New upstream version.
    + Prevent execution of enum_recv from SQL
      The function was misdeclared, allowing a simple SQL command to crash the
      server.  In principle an attacker might be able to use it to examine the
      contents of server memory.  Our thanks to Sumit Soni (via Secunia SVCRP)
      for reporting this issue. (CVE-2013-0255)
  * debian/rules: Remove the temporary patches from pg_regress, and teach
    pg_regress to support unix socket dirs in --host.

 -- Christoph Berg <myon@debian.org>  Tue, 05 Feb 2013 10:01:28 +0100

postgresql-9.2 (9.2.2-2) experimental; urgency=low

  [ Martin Pitt ]
  * Add 03-python-includedirs.patch: Detect both python3.3 include locations.
    Thanks Dmitrijs Ledkovs!
  * debian/rules: Only build the error codes and the plpython subtree for the
    "python3" flavor, to cut down build time.

  [ Christoph Berg ]
  * debian/tests: Moved autopkgtest integration here from postgresql-common.

 -- Martin Pitt <mpitt@debian.org>  Sun, 06 Jan 2013 18:16:52 +0100

postgresql-9.2 (9.2.2-1) experimental; urgency=low

  * New upstream bug fix release. See HISTORY/changelog.gz details.
  * debian/control, debian/rules: Build against krb5-multidev, to allow use
    while heimdal-dev is installed. Thanks Jelmer Vernooij! (Closes: #664881)
  * debian/control: Force p-client to use libpq5 from at least our upstream
    version, as -client tends to use private ABI and behaviour that is not
    covered by symbols files.

 -- Martin Pitt <mpitt@debian.org>  Mon, 03 Dec 2012 22:38:48 +0000

postgresql-9.2 (9.2.1-1) experimental; urgency=low

  [ Martin Pitt ]
  * New upstream bug fix release:
    - Fix persistence marking of shared buffers during WAL replay.
      This mistake can result in buffers not being written out during
      checkpoints, resulting in data corruption if the server later
      crashes without ever having written those buffers. Corruption can
      occur on any server following crash recovery, but it is
      significantly more likely to occur on standby slave servers since
      those perform much more WAL replay. There is a low probability of
      corruption of btree and GIN indexes. There is a much higher
      probability of corruption of table "visibility maps", which might
      lead to wrong answers from index-only scans. Table data proper
      cannot be corrupted by this bug.
      While no index corruption due to this bug is known to have occurred
      in the field, as a precautionary measure it is recommended that
      production installations "REINDEX" all btree and GIN indexes at a
      convenient time after upgrading to 9.2.1.
      Also, it is recommended to perform a "VACUUM" of all tables while
      having vacuum_freeze_table_age set to zero. This will fix any
      incorrect visibility map data. vacuum_cost_delay can be adjusted to
      reduce the performance impact of vacuuming, while causing it to
      take longer to finish.
    - See HISTORY/changelog.gz for other bug fixes.
  * debian/rules: Compress all binaries with xz. Thanks Cyril Brulebois!
    (Closes: #688721)

  [ Christoph Berg ]
  * Bump postgresql-common dependency to >= 135~, we need the fixed manpages
    alternatives handling. Remove the redundant dependency of the -contrib
    package on postgresql-common.

 -- Martin Pitt <mpitt@debian.org>  Tue, 25 Sep 2012 05:45:33 +0200

postgresql-9.2 (9.2.0-1) experimental; urgency=low

  * New upstream version: Official 9.2 release.
  * debian/rules: Re-enable hardening functions when hardening-wrapper is not
    installed. Use "hardening=all", but disable "pie" (as that's not
    compatible with -fPIC) and add -pie to CFLAGS explicitly. Also drop the
    explicit "-Wl,-z,now" linker option, as this is now implied with "all".
    (see LP #1039618)

 -- Martin Pitt <mpitt@debian.org>  Fri, 07 Sep 2012 07:07:07 +0200

postgresql-9.2 (9.2~rc1-1) experimental; urgency=low

  [ Christoph Berg ]
  * Update watch file to actually look for 9.2.

  [ Martin Pitt ]
  * First 9.2 release candidate.

 -- Martin Pitt <mpitt@debian.org>  Mon, 27 Aug 2012 14:26:49 +0200

postgresql-9.2 (9.2~beta4-1) experimental; urgency=low

  * Fourth 9.2 beta release.

 -- Martin Pitt <mpitt@debian.org>  Fri, 17 Aug 2012 14:46:06 +0200

postgresql-9.2 (9.2~beta3-1) experimental; urgency=low

  [ Christoph Berg ]
  * Third 9.2 beta release.
  * Some cosmetic changes to control and rules file.
  * Remove the beta1 suffix from 9.2~beta1 in symbols files as this was the
    first version.
  * Remove beta2 symbols from libpq5: PQgetRowProcessor@Base,
    PQsetRowProcessor@Base, PQskipResult@Base.
  * Add myself to Uploaders.
  * debian/source/options: Ignore .bzr-builddeb/default.conf so bzr checkouts
    can be built using dpkg-buildpackage.
  * postgresql-9.2.preinst: Remove obsolete code for transition from
    per-version init script which was never shipped in postgresql-9.2. Also,
    remove duplicate #DEBHELPER# token.

  [ Peter Eisentraut ]
  * Move pg_basebackup man page to -client-9.2, where the program is.

 -- Christoph Berg <myon@debian.org>  Tue, 07 Aug 2012 14:25:41 +0200

postgresql-9.2 (9.2~beta2-1) experimental; urgency=low

  [ Peter Eisentraut ]
  * debian/copyright: Update, fix, and simplify.
  * Add debian/source/options: Ignore test suite .sql files, to fix building
    twice in a row.

  [ Martin Pitt ]
  * Second 9.2 beta release.
  * Move pg_basebackup *.mo files to -client-9.2. Thanks to Peter Eisentraut
    for spotting this.
  * Move pg_receivexlog into -client-9.2. It can be used without the server
    being installed.
  * debian/control: Move bzr branches to alioth, so that other members of
    pkg-postgresql can commit. Update Vcs-* tags.
  * debian/control: Set Maintainer: to pkg-postgresql group, and move myself
    to Uploaders:.

 -- Martin Pitt <mpitt@debian.org>  Mon, 04 Jun 2012 06:56:59 +0200

postgresql-9.2 (9.2~beta1-1) experimental; urgency=low

  * First 9.2 beta release. Packaging based on 9.1 branch.

 -- Martin Pitt <mpitt@debian.org>  Tue, 15 May 2012 12:58:24 +0200
