postgresql-9.1 (9.1.2-3) UNRELEASED; urgency=low

  * debian/*.symbols: Update symbol versions to accurate historic data. Many
    thanks to Christoph Berg for these! (Closes: #652931)
  * Add 00git_inet_cidr_unpack.patch: Revert the behavior of inet/cidr
    functions to not unpack the arguments. This fixes the memory leak when
    sorting inet values. Patch taken from upstream git HEAD.
  * debian/control: Add missing docbook-dsssl build dependency to fix
    generation of documentation. (Closes: #654330)
  * debian/control: Use openjade instead of the ancient jade for building the
    documentation.

 -- Martin Pitt <mpitt@debian.org>  Fri, 23 Dec 2011 14:24:15 +0100

postgresql-9.1 (9.1.2-2) unstable; urgency=low

  * 01-armel-tas.patch: Turn slock_t datatype into an int, and define
    S_UNLOCK() to call __sync_lock_release() instead of using the default
    implementation. This complies to the gcc built-in atomic operations
    specifiction more strictly and now also works on the Panda boards.
    (LP: #904828)
  * Replace 01-armel-tas.patch with 01-atomic-builtins.patch to use
    gcc/intel atomic builtins if available. Drop the arm implementation as it
    does not work on newer thumb2/panda board.
  * Move PL/Python translations from -plpython-9.1 package to main
    postgresql-9.1 package, as they are also used by the -plpython3 extension.
    (Closes: #651837)
  * Move pg_basebackup from the server to the client package, it's a
    client-side program.
  * debian/control: Re-add bison and flex build dependencies, so that the
    generated and shipped Makefile.global gets non-empty BISON and FLEX
    values. (Closes: #647135)

 -- Martin Pitt <mpitt@debian.org>  Wed, 21 Dec 2011 12:07:54 +0100

postgresql-9.1 (9.1.2-1) unstable; urgency=low

  * New upstream bug fix release:
    - Fix bugs in information_schema.referential_constraints view.
      This view was being insufficiently careful about matching the
      foreign-key constraint to the depended-on primary or unique key
      constraint. That could result in failure to show a foreign key
      constraint at all, or showing it multiple times, or claiming that
      it depends on a different constraint than the one it really does.
      Since the view definition is installed by initdb, merely upgrading
      will not fix the problem. If you need to fix this in an existing
      installation, you can (as a superuser) drop the information_schema
      schema then re-create it by sourcing
      "SHAREDIR/information_schema.sql". (Run pg_config --sharedir if
      you're uncertain where "SHAREDIR" is.) This must be repeated in
      each database to be fixed.
    - Make "contrib/citext"'s upgrade script fix collations of citext
      columns and indexes.
      Existing citext columns and indexes aren't correctly marked as
      being of a collatable data type during pg_upgrade from a pre-9.1
      server. That leads to operations on them failing with errors such
      as "could not determine which collation to use for string
      comparison". This change allows them to be fixed by the same script
      that upgrades the citext module into a proper 9.1 extension during
      CREATE EXTENSION citext FROM unpackaged.
      If you have a previously-upgraded database that is suffering from
      this problem, and you already ran the "CREATE EXTENSION" command,
      you can manually run (as superuser) the "UPDATE" commands found at
      the end of "SHAREDIR/extension/citext--unpackaged--1.0.sql". (Run
      pg_config --sharedir if you're uncertain where "SHAREDIR" is.)
    - Fix possible crash during "UPDATE" or "DELETE" that joins to the
      output of a scalar-returning function.
    - Fix incorrect replay of WAL records for GIN index updates.
    - Fix TOAST-related data corruption during CREATE TABLE dest AS
      SELECT - FROM src or INSERT INTO dest SELECT * FROM src.
    - Fix possible failures during hot standby startup.
    - Start hot standby faster when initial snapshot is incomplete.
    - Fix race condition during toast table access from stale syscache
      entries. The typical symptom was transient errors like "missing chunk
      number 0 for toast value NNNNN in pg_toast_2619", where the cited toast
      table would always belong to a system catalog.
    - Track dependencies of functions on items used in parameter default
      expressions. Previously, a referenced object could be dropped without
      having dropped or modified the function, leading to misbehavior when
      the function was used. Note that merely installing this update will not
      fix the missing dependency entries; to do that, you'd need to
      "CREATE OR REPLACE" each such function afterwards. If you have
      functions whose defaults depend on non-built-in objects, doing so
      is recommended.
    - Fix incorrect management of placeholder variables in nestloop joins.
      This bug is known to lead to "variable not found in subplan target
      list" planner errors, and could possibly result in wrong query
      output when outer joins are involved.
    - Fix window functions that sort by expressions involving aggregates.
    - Fix "MergeAppend child's targetlist doesn't match MergeAppend"
      planner errors.
    - Fix index matching for operators with both collatable and
      noncollatable inputs. In 9.1.0, an indexable operator that has a
      non-collatable left-hand input type and a collatable right-hand input
      type would not be recognized as matching the left-hand column's index.
      An example is the hstore ? text operator.
    - Allow inlining of set-returning SQL functions with multiple OUT
      parameters.
    - Don't trust deferred-unique indexes for join removal.
    - Make DatumGetInetP() unpack inet datums that have a 1-byte header,
      and add a new macro, DatumGetInetPP(), that does not.
    - Improve locale support in money type's input and output.
      Aside from not supporting all standard lc_monetary formatting
      options, the input and output functions were inconsistent, meaning
      there were locales in which dumped money values could not be
      re-read.
    - Don't let transform_null_equals affect CASE foo WHEN NULL ...
      constructs.  transform_null_equals is only supposed to affect foo =
      NULL expressions written directly by the user, not equality checks
      generated internally by this form of CASE.
    - Change foreign-key trigger creation order to better support
      self-referential foreign keys.
    - Fix IF EXISTS to work correctly in "DROP OPERATOR FAMILY".
    - Disallow dropping of an extension from within its own script.
    - Don't mark auto-generated types as extension members.
    - Cope with invalid pre-existing search_path settings during "CREATE
      EXTENSION".
    - Avoid floating-point underflow while tracking buffer allocation
      rate.
    - Prevent autovacuum transactions from running in serializable mode.
      Autovacuum formerly used the cluster-wide default transaction
      isolation level, but there is no need for it to use anything higher
      than READ COMMITTED, and using SERIALIZABLE could result in
      unnecessary delays for other processes.
    - Ensure walsender processes respond promptly to SIGTERM.
    - Exclude "postmaster.opts" from base backups.
    - Fix incorrect field alignment in ecpg's SQLDA area.
    - Preserve blank lines within commands in psql's command history.
      The former behavior could cause problems if an empty line was
      removed from within a string literal, for example.
    - Avoid platform-specific infinite loop in pg_dump.
    - Fix compression of plain-text output format in pg_dump.
      pg_dump has historically understood -Z with no -F switch to mean
      that it should emit a gzip-compressed version of its plain text
      output. Restore that behavior.
    - Fix pg_dump to dump user-defined casts between auto-generated
      types, such as table rowtypes.
    - Fix missed quoting of foreign server names in pg_dump.
    - Assorted fixes for pg_upgrade. Handle exclusion constraints correctly,
      avoid failures on Windows, don't complain about mismatched toast table
      names in 8.4 databases.
    - In PL/pgSQL, allow foreign tables to define row types.
    - Fix up conversions of PL/Perl functions' results.
      Restore the pre-9.1 behavior that PL/Perl functions returning void
      ignore the result value of their last Perl statement; 9.1.0 would
      throw an error if that statement returned a reference. Also, make
      sure it works to return a string value for a composite type, so
      long as the string meets the type's input format. In addition,
      throw errors for attempts to return Perl arrays or hashes when the
      function's declared result type is not an array or composite type,
      respectively. (Pre-9.1 versions rather uselessly returned strings
      like ARRAY(0x221a9a0) or HASH(0x221aa90) in such cases.)
    - Ensure PL/Perl strings are always correctly UTF8-encoded.
    - Use the preferred version of xsubpp to build PL/Perl, not
      necessarily the operating system's main copy.
    - Correctly propagate SQLSTATE in PL/Python exceptions.
    - Do not install PL/Python extension files for Python major versions
      other than the one built against.
    - Change all the "contrib" extension script files to report a useful
      error message if they are fed to psql. This should help teach people
      about the new method of using "CREATE EXTENSION" to load these files.
      In most cases, sourcing the scripts directly would fail anyway, but
      with harder-to-interpret messages.
    - Fix incorrect coding in "contrib/dict_int" and "contrib/dict_xsyn".
    - Remove "contrib/sepgsql" tests from the regular regression test
      mechanism. Since these tests require root privileges for setup, they're
      impractical to run automatically. Switch over to a manual approach
      instead, and provide a testing script to help with that.
    - Fix assorted errors in "contrib/unaccent"'s configuration file
      parsing.
    - Honor query cancel interrupts promptly in pgstatindex().
    - Revert unintentional enabling of WAL_DEBUG. Fortunately, as debugging
      tools go, this one is pretty cheap; but it's not intended to be enabled
      by default, so revert.
    - Ensure VPATH builds properly install all server header files.
    - Shorten file names reported in verbose error messages.
      Regular builds have always reported just the name of the C file
      containing the error message call, but VPATH builds formerly
      reported an absolute path name.
  * debian/rules: Fix build failure for binary-indep-only builds.
    (Closes: #646079)

 -- Martin Pitt <mpitt@debian.org>  Fri, 02 Dec 2011 14:39:18 +0100

postgresql-9.1 (9.1.1-3) unstable; urgency=low

  * debian/rules: Build with LINUX_OOM_ADJ=0 on Linux, to allow the OOM killer
    to slay the backends when the postmaster gets marked as unkillable.
    (LP: #854590)

 -- Martin Pitt <mpitt@debian.org>  Wed, 19 Oct 2011 09:43:13 +0200

postgresql-9.1 (9.1.1-2) unstable; urgency=low

  [ Peter Eisentraut ]
  * Fix FTBFS twice with dpkg-dev >= 1.16.1, because of leftover file
    src/backend/gettext-files.  Clean that one explicitly. (Closes: #643645)
  * Fix lintian reports: (Closes: #643646)
    - brace-expansion-in-debhelper-config-file
    - maintainer-script-without-set-e

  [ Martin Pitt ]
  * debian/*.install, debian/rules: Compress manpages in debian/tmp instead of
    just two binary packages and forgetting the others.
  * Build a new postgresql-plpython3-9.1 package for Python 3 support. This
    requires some reorganization of debian/rules to do multiple builds.
  * debian/postgresql-9.1.postrm: Clean up /var/log/postgresql/ on purge.
    Spotted by piuparts.

 -- Martin Pitt <mpitt@debian.org>  Fri, 07 Oct 2011 18:52:55 +0200

postgresql-9.1 (9.1.1-1) unstable; urgency=low

  * New upstream bug fix release:
    - Make pg_options_to_table return NULL for an option with no value.
      Previously such cases would result in a server crash.
    - Fix memory leak at end of a GiST index scan.
      Commands that perform many separate GiST index scans, such as
      verification of a new GiST-based exclusion constraint on a table
      already containing many rows, could transiently require large
      amounts of memory due to this leak.
    - Fix explicit reference to pg_temp schema in "CREATE TEMPORARY
      TABLE". This used to be allowed, but failed in 9.1.0.

 -- Martin Pitt <mpitt@debian.org>  Mon, 26 Sep 2011 14:35:36 +0200

postgresql-9.1 (9.1.0-1) unstable; urgency=low

  * Final 9.1 release.
  * 02-relax-sslkey-permscheck.patch, 50-per-version-dirs.patch: Refresh to
    apply cleanly.
  * debian/control: Tighten the dependencies of the -pl* extensions/-contrib
    to postgresql-9.1 to the same binary version. (Closes: #640335)

 -- Martin Pitt <mpitt@debian.org>  Mon, 12 Sep 2011 16:02:28 +0200

postgresql-9.1 (9.1~rc1-3) unstable; urgency=low

  * debian/watch: Fix for mangling ~rc, thanks Peter Eisentraut. 
    (Closes: #639357)
  * debian/control: Add versionless Provides: to the PL* extensions, as per
    request from Christoph Berg.
  * debian/control: Add "Replaces: postgresql-9.0-dbg" to fix file conflict.
    (Closes: #639258)
  * debian/control: Drop the versionless metapackages, they are built from
    postgresql-common now. This behaves better with backports. Thanks to
    Christoph Berg for the suggestion.

 -- Martin Pitt <mpitt@debian.org>  Sat, 27 Aug 2011 13:42:40 +0200

postgresql-9.1 (9.1~rc1-2) unstable; urgency=low

  * debian/control: Build the versionless metapackages again, and point them
    to 9.1.

 -- Martin Pitt <mpitt@debian.org>  Thu, 25 Aug 2011 12:50:45 +0200

postgresql-9.1 (9.1~rc1-1) unstable; urgency=low

  * New upstream release.
  * Upload to unstable now that the final 9.1 release will come soon. 9.1 will
    most probably be the version supported in the Wheezy release.
  * 54-debian-alternatives-for-external-tools.patch: Unfuzz for new release.
  * debian/control: Suggest locales-all. (Closes: #629875)
  * debian/control: Wrap dependencies.
  * debian/control: Add explicit jade build dependency. (see #621492 for the
    corresponding 9.0 bug report)

 -- Martin Pitt <mpitt@debian.org>  Sun, 21 Aug 2011 20:59:58 +0200

postgresql-9.1 (9.1~beta3-1) experimental; urgency=low

  * New upstream beta release.
    - Works around gcc 4.6.0 bug. (Closes: #633086)

    Note that this does not change the data format since Beta 2, so no need
    to dump/reload clusters.

 -- Martin Pitt <mpitt@debian.org>  Thu, 14 Jul 2011 18:39:43 +0200

postgresql-9.1 (9.1~beta2-1) experimental; urgency=low

  * New upstream beta release.
  * Drop 03-cmsgcred-size.patch, fixed upstream.
  * debian/postgresql-9.1.install: Install new pg_basebackup translations.
  * debian/control: Fix the server-dev dependency to p-common to also work for
    backports.
  * debian/watch: Fix for beta versions.
  * debian/copyright: Add pointers to GPL and Artistic licenses for the Perl
    terms.
  * debian/postgresql-9.1.preinst: Fail the package upgrade early when
    upgrading from beta-1, as the DB format changed.

 -- Martin Pitt <mpitt@debian.org>  Tue, 14 Jun 2011 09:53:29 +0200

postgresql-9.1 (9.1~beta1-4) experimental; urgency=low

  * debian/control: Add postgresql-common dependency to -server-dev, so that
    we get the pg_config diversion.
  * 52-tutorial-README.patch: Fix server-dev version in comment.
  * 51-default-sockets-in-var.patch: Move the pg_regress patching parts to
    debian/pg_regress-in-tmp.patch and temporarily apply it only for running
    the local checks. In the installed system it seems we actually do want it
    to use the /var/run/postgresql socket dir. (Closes: #554166)

 -- Martin Pitt <mpitt@debian.org>  Sun, 29 May 2011 19:34:38 +0200

postgresql-9.1 (9.1~beta1-3) experimental; urgency=low

  * Move /usr/share/postgresql/9.1/extension/pl* from -contrib into the actual
    -pl* packages, and ship PL/pgsql in postgresql-9.1.
  * debian/copyright: Convert to DEP-5.
  * debian/copyright: Add current copyrights, thanks to Ansgar Burchardt for
    noticing.
  * Add 03-cmsgcred-size.patch: Fix size of struct cmsgcred to fix ident
    authentication on kFreeBSD 64 bit. Thanks to Petr Salinger for the
    patch! (Closes: #627597)

 -- Martin Pitt <mpitt@debian.org>  Sun, 22 May 2011 20:44:36 +0200

postgresql-9.1 (9.1~beta1-2) experimental; urgency=low

  * debian/control: Add missing ${misc:Depends} to -dbg.
  * Bump Standards-Version to 3.9.2 (no changes necessary).
  * debian/rules: Fix FTBFS with only-binary (-B) builds.

 -- Martin Pitt <martin.pitt@ubuntu.com>  Wed, 11 May 2011 10:41:53 +0200

postgresql-9.1 (9.1~beta1-1) experimental; urgency=low

  * First 9.1 beta release. Packaging based on 9.1 branch.
  * debian/control: Do not build the versionless metapackages for now, as long
    as 9.0 is still the default.

 -- Martin Pitt <mpitt@debian.org>  Wed, 11 May 2011 09:18:56 +0200
